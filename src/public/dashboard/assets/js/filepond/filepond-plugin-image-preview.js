/*!
 * FilePondPluginImagePreview 4.6.11
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
*/ !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FilePondPluginImagePreview=t()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,r,i){ey||(ey="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var a in n)void 0===t[a]&&(t[a]=n[a]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var c=Array(o),s=0;s<o;s++)c[s]=arguments[s+3];t.children=c}return{$$typeof:ey,type:e,key:void 0===r?null:""+r,ref:null,props:t,_owner:null}}function r(e){var t;if("function"==typeof Symbol&&(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator])||Symbol.iterator&&null!=(t=e[Symbol.iterator])))return t.call(e);throw TypeError("Object is not async iterable")}function i(e){this.wrapped=e}function n(e){var t,r;function n(t,r){try{var a=e[t](r),c=a.value,s=c instanceof i;Promise.resolve(s?c.wrapped:c).then(function(e){if(s){n("next",e);return}o(a.done?"return":"normal",e)},function(e){n("throw",e)})}catch(u){o("throw",u)}}function o(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function e(i,o){return new Promise(function(e,a){var c={key:i,arg:o,resolve:e,reject:a,next:null};r?r=r.next=c:(t=r=c,n(i,o))})},"function"!=typeof e.return&&(this.return=void 0)}function o(e){return function(){return new n(e.apply(this,arguments))}}function a(e){return new i(e)}function c(e,t){var r={},i=!1;function n(r,n){return i=!0,n=new Promise(function(t){t(e[r](n))}),{done:!1,value:t(n)}}return"function"==typeof Symbol&&Symbol.iterator&&(r[Symbol.iterator]=function(){return this}),r.next=function(e){return i?(i=!1,e):n("next",e)},"function"==typeof e.throw&&(r.throw=function(e){if(i)throw i=!1,e;return n("throw",e)}),"function"==typeof e.return&&(r.return=function(e){return n("return",e)}),r}function s(e,t,r,i,n,o,a){try{var c=e[o](a),s=c.value}catch(u){r(u);return}c.done?t(s):Promise.resolve(s).then(i,n)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(i,n){var o=e.apply(t,r);function a(e){s(o,i,n,a,c,"next",e)}function c(e){s(o,i,n,a,c,"throw",e)}a(void 0)})}}function l(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}function d(e,t){for(var r in t){var i=t[r];i.configurable=i.enumerable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r,i)}if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(t),o=0;o<n.length;o++){var a=n[o],i=t[a];i.configurable=i.enumerable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a,i)}return e}function h(e,t){for(var r=Object.getOwnPropertyNames(t),i=0;i<r.length;i++){var n=r[i],o=Object.getOwnPropertyDescriptor(t,n);o&&o.configurable&&void 0===e[n]&&Object.defineProperty(e,n,o)}return e}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),i.forEach(function(t){g(e,t,r[t])})}return e}function m(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function $(e,t){return($=Object.setPrototypeOf||function e(t,r){return t.__proto__=r,t})(e,t)}function E(e,t,r){return(E=!function e(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?function e(t,r,i){var n=[null];n.push.apply(n,r);var o=new(Function.bind.apply(t,n));return i&&$(o,i.prototype),o}:Reflect.construct).apply(null,arguments)}function I(e){var t="function"==typeof Map?new Map:void 0;return(I=function e(r){var i;if(null===r||(i=r,-1===Function.toString.call(i).indexOf("[native code]")))return r;if("function"!=typeof r)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(r))return t.get(r);t.set(r,n)}function n(){return E(r,arguments,w(this).constructor)}return n.prototype=Object.create(r.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),$(n,r)})(e)}function x(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function _(e){return e&&e.__esModule?e:{default:e}}function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}}return t.default=e,t}function b(e,t){if(e!==t)throw TypeError("Cannot instantiate an arrow function")}function k(e){if(null==e)throw TypeError("Cannot destructure undefined")}function T(e,t){if(null==e)return{};var r,i,n=function e(t,r){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],r.indexOf(i)>=0||(o[i]=t[i]);return o}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function A(e,t){return t&&("object"==typeof t||"function"==typeof t)?t:function e(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)}function D(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}function R(e,t,r){return(R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function e(t,r,i){var n=D(t,r);if(n){var o=Object.getOwnPropertyDescriptor(n,r);return o.get?o.get.call(i):o.value}})(e,t,r||e)}function C(e,t,r,i){return(C="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function e(t,r,i,n){var o,a=D(t,r);if(a){if((o=Object.getOwnPropertyDescriptor(a,r)).set)return o.set.call(n,i),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,r)){if(!o.writable)return!1;o.value=i,Object.defineProperty(n,r,o)}else g(n,r,i);return!0})(e,t,r,i)}function M(e,t,r,i,n){if(!C(e,t,r,i||e)&&n)throw Error("failed to set property");return r}function O(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function G(e,t){return t||(t=e.slice(0)),e.raw=t,e}function V(e,t){if(e!==N)return e;throw ReferenceError(t+" is not defined - temporal dead zone")}function S(e){throw Error('"'+e+'" is read-only')}function z(e){throw Error('Class "'+e+'" cannot be referenced in computed property keys.')}"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(e){return this._invoke("next",e)},n.prototype.throw=function(e){return this._invoke("throw",e)},n.prototype.return=function(e){return this._invoke("return",e)};var N={};function L(e,t){return H(e)||function e(t,r){var i=[],n=!0,o=!1,a=void 0;try{for(var c,s=t[Symbol.iterator]();!(n=(c=s.next()).done)&&(i.push(c.value),!r||i.length!==r);n=!0);}catch(u){o=!0,a=u}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return i}(e,t)||Y()}function W(e,t){return H(e)||function e(t,r){for(var i,n=[],o=t[Symbol.iterator]();!(i=o.next()).done&&(n.push(i.value),!r||n.length!==r););return n}(e,t)||Y()}function F(e){return function e(t){if(Array.isArray(t)){for(var r=0,i=Array(t.length);r<t.length;r++)i[r]=t[r];return i}}(e)||q(e)||function e(){throw TypeError("Invalid attempt to spread non-iterable instance")}()}function H(e){if(Array.isArray(e))return e}function q(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function Y(){throw TypeError("Invalid attempt to destructure non-iterable instance")}function U(e){return function(){var t=e.apply(this,arguments);return t.next(),t}}function X(e){var t=function e(t,r){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,r||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(e,"string");return"symbol"==typeof t?t:String(t)}function j(e,t){throw Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and set to use loose mode. To use proposal-class-properties in spec mode with decorators, wait for the next major version of decorators in stage 2.")}function B(e,t,r,i){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function Z(e,t,r,i,n){var o={};return Object.keys(i).forEach(function(e){o[e]=i[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},o),n&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(n):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var K=0;function J(e){return"__private_"+K+++"_"+e}function Q(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}function ee(e,t){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");var r=t.get(e);return r.get?r.get.call(e):r.value}function et(e,t,r){if(!t.has(e))throw TypeError("attempted to set private field on non-instance");var i=t.get(e);if(i.set)i.set.call(e,r);else{if(!i.writable)throw TypeError("attempted to set read only private field");i.value=r}return r}function er(e,t,r){if(e!==t)throw TypeError("Private static access of wrong provenance");return r.value}function ei(e,t,r,i){if(e!==t)throw TypeError("Private static access of wrong provenance");if(!r.writable)throw TypeError("attempted to set read only private field");return r.value=i,i}function en(e,t,r){if(e!==t)throw TypeError("Private static access of wrong provenance");return r}function eo(){throw TypeError("attempted to set read only static private field")}function ea(e,t,r,i){var n=ec();if(i)for(var o=0;o<i.length;o++)n=i[o](n);var a=t(function e(t){n.initializeInstanceElements(t,c.elements)},r),c=n.decorateClass(function e(t){for(var r=[],i=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},n=0;n<t.length;n++){var o,a=t[n];if("method"===a.kind&&(o=r.find(i))){if(ef(a.descriptor)||ef(o.descriptor)){if(el(a)||el(o))throw ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");o.descriptor=a.descriptor}else{if(el(a)){if(el(o))throw ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");o.decorators=a.decorators}eu(a,o)}}else r.push(a)}return r}(a.d.map(es)),e);return n.initializeClassElements(a.F,c.elements),n.runClassFinishers(a.F,c.finishers)}function ec(){ec=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach(function(r){t.forEach(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)},this)},this)},initializeClassElements:function(e,t){var r=e.prototype;["method","field"].forEach(function(i){t.forEach(function(t){var n=t.placement;t.kind===i&&("static"===n||"prototype"===n)&&this.defineClassElement("static"===n?e:r,t)},this)},this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}Object.defineProperty(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],n={static:[],prototype:[],own:[]};if(e.forEach(function(e){this.addElementPlacement(e,n)},this),e.forEach(function(e){if(!el(e))return r.push(e);var t=this.decorateElement(e,n);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)},this),!t)return{elements:r,finishers:i};var o=this.decorateConstructor(r,t);return i.push.apply(i,o.finishers),o.finishers=i,o},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==i.indexOf(e.key))throw TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],n=e.decorators,o=n.length-1;o>=0;o--){var a=t[e.placement];a.splice(a.indexOf(e.key),1);var c=this.fromElementDescriptor(e),s=this.toElementFinisherExtras((0,n[o])(c)||c);e=s.element,this.addElementPlacement(e,t),s.finisher&&i.push(s.finisher);var u=s.extras;if(u){for(var l=0;l<u.length;l++)this.addElementPlacement(u[l],t);r.push.apply(r,u)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[i])(n)||n);if(void 0!==o.finisher&&r.push(o.finisher),void 0!==o.elements){e=o.elements;for(var a=0;a<e.length-1;a++)for(var c=a+1;c<e.length;c++)if(e[a].key===e[c].key&&e[a].placement===e[c].placement)throw TypeError("Duplicated element ("+e[a].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){if(void 0!==e){var t;return(H(t=e)||q(t)||Y()).map(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t},this)}},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=X(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:r,placement:i,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){var t=this.toElementDescriptor(e),r=ep(e,"finisher");return{element:t,finisher:r,extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=ep(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw TypeError(r+" can't have a ."+t+" property.")}};return e}function es(e){var t,r=X(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function eu(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function el(e){return e.decorators&&e.decorators.length}function ef(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function ep(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw TypeError("Expected '"+t+"' to be a function");return r}function ed(e,t,r){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return r}function eh(){throw TypeError("attempted to reassign private method")}function eg(e,t){eg=function(e,t){return new o(e,t)};var r=I(RegExp),i=RegExp.prototype,n=new WeakMap;function o(e,t){var i=r.call(this,e);return n.set(i,t),i}function a(e,t){var r=n.get(t);return Object.keys(r).reduce(function(t,i){return t[i]=e[r[i]],t},Object.create(null))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&$(t,r)}(o,r),o.prototype.exec=function(e){var t=i.exec.call(this,e);return t&&(t.groups=a(t,this)),t},o.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=n.get(this);return i[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,function(e,t){return"$"+r[t]}))}if("function"!=typeof t)return i[Symbol.replace].call(this,e,t);var o=this;return i[Symbol.replace].call(this,e,function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(a(e,o)),t.apply(this,e)})},eg.apply(this,arguments)}var ey,ev=function e(t,r){return eE(t.x*r,t.y*r)},em=function e(t,r){return eE(t.x+r.x,t.y+r.y)},ew=function e(t){var r=Math.sqrt(t.x*t.x+t.y*t.y);return 0===r?{x:0,y:0}:eE(t.x/r,t.y/r)},e$=function e(t,r,i){var n=Math.cos(r),o=Math.sin(r),a=eE(t.x-i.x,t.y-i.y);return eE(i.x+n*a.x-o*a.y,i.y+o*a.x+n*a.y)},eE=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{x:t,y:r}},e8=function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3?arguments[3]:void 0;return"string"==typeof t?parseFloat(t)*i:"number"==typeof t?t*(n?r[n]:Math.min(r.width,r.height)):void 0},eI=function e(t,r,i){var n=t.borderStyle||t.lineStyle||"solid",o=t.backgroundColor||t.fontColor||"transparent",a=t.borderColor||t.lineColor||"transparent",c=e8(t.borderWidth||t.lineWidth,r,i),s=t.lineCap||"round",u=t.lineJoin||"round",l="string"==typeof n?"":n.map(function(e){return e8(e,r,i)}).join(",");return{"stroke-linecap":s,"stroke-linejoin":u,"stroke-width":c||0,"stroke-dasharray":l,stroke:a,fill:o,opacity:t.opacity||1}},ex=function e(t){return null!=t},e_=function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=e8(t.x,r,i,"width")||e8(t.left,r,i,"width"),o=e8(t.y,r,i,"height")||e8(t.top,r,i,"height"),a=e8(t.width,r,i,"width"),c=e8(t.height,r,i,"height"),s=e8(t.right,r,i,"width"),u=e8(t.bottom,r,i,"height");return ex(o)||(o=ex(c)&&ex(u)?r.height-c-u:u),ex(n)||(n=ex(a)&&ex(s)?r.width-a-s:s),ex(a)||(a=ex(n)&&ex(s)?r.width-n-s:0),ex(c)||(c=ex(o)&&ex(u)?r.height-o-u:0),{x:n||0,y:o||0,width:a||0,height:c||0}},eP=function e(t,r){return Object.keys(r).forEach(function(e){return t.setAttribute(e,r[e])})},eb=function e(t,r){var i=document.createElementNS("http://www.w3.org/2000/svg",t);return r&&eP(i,r),i},ek=function e(t){return eP(t,Object.assign({},t.rect,t.styles))},eT=function e(t){var r=t.rect.x+.5*t.rect.width,i=t.rect.y+.5*t.rect.height,n=.5*t.rect.width,o=.5*t.rect.height;return eP(t,Object.assign({cx:r,cy:i,rx:n,ry:o},t.styles))},eA={contain:"xMidYMid meet",cover:"xMidYMid slice"},eD=function e(t,r){eP(t,Object.assign({},t.rect,t.styles,{preserveAspectRatio:eA[r.fit]||"none"}))},eR={left:"start",center:"middle",right:"end"},eC=function e(t,r,i,n){var o=e8(r.fontSize,i,n),a=r.fontFamily||"sans-serif",c=r.fontWeight||"normal",s=eR[r.textAlign]||"start";eP(t,Object.assign({},t.rect,t.styles,{"stroke-width":0,"font-weight":c,"font-size":o,"font-family":a,"text-anchor":s})),t.text!==r.text&&(t.text=r.text,t.textContent=r.text.length?r.text:" ")},eM=function e(t,r,i,n){eP(t,Object.assign({},t.rect,t.styles,{fill:"none"}));var o=t.childNodes[0],a=t.childNodes[1],c=t.childNodes[2],s=t.rect,u={x:t.rect.x+t.rect.width,y:t.rect.y+t.rect.height};if(eP(o,{x1:s.x,y1:s.y,x2:u.x,y2:u.y}),r.lineDecoration){a.style.display="none",c.style.display="none";var l=ew({x:u.x-s.x,y:u.y-s.y}),f=e8(.05,i,n);if(-1!==r.lineDecoration.indexOf("arrow-begin")){var p=ev(l,f),d=em(s,p),h=e$(s,2,d),g=e$(s,-2,d);eP(a,{style:"display:block;",d:"M".concat(h.x,",").concat(h.y," L").concat(s.x,",").concat(s.y," L").concat(g.x,",").concat(g.y)})}if(-1!==r.lineDecoration.indexOf("arrow-end")){var y=ev(l,-f),v=em(u,y),m=e$(u,2,v),w=e$(u,-2,v);eP(c,{style:"display:block;",d:"M".concat(m.x,",").concat(m.y," L").concat(u.x,",").concat(u.y," L").concat(w.x,",").concat(w.y)})}}},eO=function e(t,r,i,n){var o;eP(t,Object.assign({},t.styles,{fill:"none",d:(o=r.points.map(function(e){return{x:e8(e.x,i,n,"width"),y:e8(e.y,i,n,"height")}})).map(function(e,t){return"".concat(0===t?"M":"L"," ").concat(e.x," ").concat(e.y)}).join(" ")}))},eG=function e(t){return function(e){return eb(t,{id:e.id})}},e3=function e(t){var r=eb("g",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round"}),i=eb("line");r.appendChild(i);var n=eb("path");r.appendChild(n);var o=eb("path");return r.appendChild(o),r},eV={image:function e(t){var r=eb("image",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return r.onload=function(){r.setAttribute("opacity",t.opacity||1)},r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.src),r},rect:eG("rect"),ellipse:eG("ellipse"),text:eG("text"),path:eG("path"),line:e3},e0={rect:ek,ellipse:eT,image:eD,text:eC,path:eO,line:eM},eS=function e(t,r,i,n,o){"path"!==r&&(t.rect=e_(i,n,o)),t.styles=eI(i,n,o),e0[r](t,i,n,o)},ez=["x","y","left","top","right","bottom","width","height"],eN=function e(t){var r=L(t,2),i=r[0],n=r[1],o=n.points?{}:ez.reduce(function(e,t){var r;return e[t]="string"==typeof(r=n[t])&&/%/.test(r)?parseFloat(r)/100:r,e},{});return[i,Object.assign({zIndex:0},n,o)]},eL=function e(t,r){return t[1].zIndex>r[1].zIndex?1:t[1].zIndex<r[1].zIndex?-1:0},eW=function e(t,r){return{x:t,y:r}},eF=function e(t,r){return eW(t.x-r.x,t.y-r.y)},eH=function e(t,r){var i,n;return i=eF(t,r),n=eF(t,r),i.x*n.x+i.y*n.y},eq=function e(t,r){return Math.sqrt(eH(t,r))},eY=function e(t,r){var i=1.5707963267948966-r,n=Math.cos(i),o=t/1;return eW(n*(o*Math.sin(r)),n*(o*Math.sin(i)))},eU=function e(t,r){var i=t.width,n=t.height,o=eY(i,r),a=eY(n,r),c=eW(t.x+Math.abs(o.x),t.y-Math.abs(o.y)),s=eW(t.x+t.width+Math.abs(a.y),t.y+Math.abs(a.x)),u=eW(t.x-Math.abs(a.y),t.y+t.height-Math.abs(a.x));return{width:eq(c,s),height:eq(c,u)}},eX=function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=t.height/t.width,o=r,a=1,c=n;c>o&&(a=(c=o)/n);var s=Math.max(1/a,o/c),u=t.width/(i*s*a);return{width:u,height:u*r}},ej=function e(t,r,i,n){var o=n.x>.5?1-n.x:n.x,a=n.y>.5?1-n.y:n.y,c=2*o*t.width,s=2*a*t.height,u=eU(r,i);return Math.max(u.width/c,u.height/s)},e4=function e(t,r){var i,n=t.width,o=n*r;return o>t.height&&(n=(o=t.height)/r),{x:(t.width-n)*.5,y:(t.height-o)*.5,width:n,height:o}},e2=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.zoom,n=r.rotation,o=r.center,a=r.aspectRatio;a||(a=t.height/t.width);var c=eX(t,a,i),s={x:.5*c.width,y:.5*c.height},u={x:0,y:0,width:c.width,height:c.height,center:s},l=void 0===r.scaleToFit||r.scaleToFit,f=ej(t,e4(u,a),n,l?o:{x:.5,y:.5}),p=i*f;return{widthFloat:c.width/p,heightFloat:c.height/p,width:Math.round(c.width/p),height:Math.round(c.height/p)}},e6={type:"spring",stiffness:.5,damping:.45,mass:10},eB=0,eZ=function e(){self.onmessage=function(e){createImageBitmap(e.data.message.file).then(function(t){self.postMessage({id:e.data.id,message:t},[t])})}},e1=function e(){self.onmessage=function(e){for(var t=e.data.message.imageData,r=e.data.message.colorMatrix,i=t.data,n=i.length,o=r[0],a=r[1],c=r[2],s=r[3],u=r[4],l=r[5],f=r[6],p=r[7],d=r[8],h=r[9],g=r[10],y=r[11],v=r[12],m=r[13],w=r[14],$=r[15],E=r[16],I=r[17],x=r[18],_=r[19],P=0,b=0,k=0,T=0,A=0;P<n;P+=4)b=i[P]/255,k=i[P+1]/255,T=i[P+2]/255,A=i[P+3]/255,i[P]=Math.max(0,Math.min((b*o+k*a+T*c+A*s+u)*255,255)),i[P+1]=Math.max(0,Math.min((b*l+k*f+T*p+A*d+h)*255,255)),i[P+2]=Math.max(0,Math.min((b*g+k*y+T*v+A*m+w)*255,255)),i[P+3]=Math.max(0,Math.min((b*$+k*E+T*I+A*x+_)*255,255));self.postMessage({id:e.data.id,message:t},[t.data.buffer])}},e7=function e(t,r){var i=new Image;i.onload=function(){var e=i.naturalWidth,t=i.naturalHeight;i=null,r(e,t)},i.src=t},e5={1:function e(){return[1,0,0,1,0,0]},2:function e(t){return[-1,0,0,1,t,0]},3:function e(t,r){return[-1,0,0,-1,t,r]},4:function e(t,r){return[1,0,0,-1,0,r]},5:function e(){return[0,1,1,0,0,0]},6:function e(t,r){return[0,1,-1,0,r,0]},7:function e(t,r){return[0,-1,-1,0,r,t]},8:function e(t){return[0,-1,1,0,0,t]}},eK=function e(t,r,i,n){-1!==n&&t.transform.apply(t,e5[n](r,i))},e9=function e(t,r,i,n){r=Math.round(r),i=Math.round(i);var o=document.createElement("canvas");o.width=r,o.height=i;var a=o.getContext("2d");if(n>=5&&n<=8){var c=[i,r];r=c[0],i=c[1]}return eK(a,r,i,n),a.drawImage(t,0,0,r,i),o},eJ=function e(t){return/^image/.test(t.type)&&!/svg/.test(t.type)},eQ=function e(t){var r=Math.min(10/t.width,10/t.height),i=document.createElement("canvas"),n=i.getContext("2d"),o=i.width=Math.ceil(t.width*r),a=i.height=Math.ceil(t.height*r);n.drawImage(t,0,0,o,a);var c=null;try{c=n.getImageData(0,0,o,a).data}catch(s){return null}for(var u=c.length,l=0,f=0,p=0,d=0;d<u;d+=4)l+=c[d]*c[d],f+=c[d+1]*c[d+1],p+=c[d+2]*c[d+2];return l=te(l,u),f=te(f,u),p=te(p,u),{r:l,g:f,b:p}},te=function e(t,r){return Math.floor(Math.sqrt(t/(r/4)))},tt=function e(t){var r;try{r=new ImageData(t.width,t.height)}catch(i){r=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return r.data.set(new Uint8ClampedArray(t.data)),r},tr=function e(t){var r,i,n=(r=t).utils.createView({name:"image-preview-overlay",tag:"div",ignoreRect:!0,create:function e(t){var r=t.root,i=t.props,n='<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n    <defs>\n        <radialGradient id="gradient-__UID__" cx=".5" cy="1.25" r="1.15">\n            <stop offset=\'50%\' stop-color=\'#000000\'/>\n            <stop offset=\'56%\' stop-color=\'#0a0a0a\'/>\n            <stop offset=\'63%\' stop-color=\'#262626\'/>\n            <stop offset=\'69%\' stop-color=\'#4f4f4f\'/>\n            <stop offset=\'75%\' stop-color=\'#808080\'/>\n            <stop offset=\'81%\' stop-color=\'#b1b1b1\'/>\n            <stop offset=\'88%\' stop-color=\'#dadada\'/>\n            <stop offset=\'94%\' stop-color=\'#f6f6f6\'/>\n            <stop offset=\'100%\' stop-color=\'#ffffff\'/>\n        </radialGradient>\n        <mask id="mask-__UID__">\n            <rect x="0" y="0" width="500" height="200" fill="url(#gradient-__UID__)"></rect>\n        </mask>\n    </defs>\n    <rect x="0" width="500" height="200" fill="currentColor" mask="url(#mask-__UID__)"></rect>\n</svg>';if(document.querySelector("base")){var o=new URL(window.location.href.replace(window.location.hash,"")).href;n=n.replace(/url\(\#/g,"url("+o+"#")}eB++,r.element.classList.add("filepond--image-preview-overlay-".concat(i.status)),r.element.innerHTML=n.replace(/__UID__/g,eB)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),o=(i=t).utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,mixins:{apis:["image","crop","markup","resize","dirty","background"],styles:["translateY","scaleX","scaleY","opacity"],animations:{scaleX:e6,scaleY:e6,translateY:e6,opacity:{type:"tween",duration:400}}},create:function e(t){var r,n=t.root,o=t.props;n.ref.clip=n.appendChildView(n.createChildView((r=i).utils.createView({name:"image-clip",tag:"div",ignoreRect:!0,mixins:{apis:["crop","markup","resize","width","height","dirty","background"],styles:["width","height","opacity"],animations:{opacity:{type:"tween",duration:250}}},didWriteView:function e(t){var r=t.root,i=t.props;i.background&&(r.element.style.backgroundColor=i.background)},create:function e(t){var i,n=t.root,o=t.props;n.ref.image=n.appendChildView(n.createChildView((i=r).utils.createView({name:"image-canvas-wrapper",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ"],animations:{originX:e6,originY:e6,scaleX:e6,scaleY:e6,translateX:e6,translateY:e6,rotateZ:e6}},create:function e(t){var r,n=t.root,o=t.props;o.width=o.image.width,o.height=o.image.height,n.ref.bitmap=n.appendChildView(n.createChildView((r=i).utils.createView({name:"image-bitmap",ignoreRect:!0,mixins:{styles:["scaleX","scaleY"]},create:function e(t){var r=t.root,i=t.props;r.appendChild(i.image)}}),{image:o.image}))},write:function e(t){var r=t.root,i=t.props.crop.flip,n=r.ref.bitmap;n.scaleX=i.horizontal?-1:1,n.scaleY=i.vertical?-1:1}}),Object.assign({},o))),n.ref.createMarkup=function(){if(!n.ref.markup){var e;n.ref.markup=n.appendChildView(n.createChildView((e=r).utils.createView({name:"image-preview-markup",tag:"svg",ignoreRect:!0,mixins:{apis:["width","height","crop","markup","resize","dirty"]},write:function e(t){var r=t.root,i=t.props;if(i.dirty){var n=i.crop,o=i.resize,a=i.markup,c=i.width,s=i.height,u=n.width,l=n.height;if(o){var f=o.size,p=f&&f.width,d=f&&f.height,h=o.mode,g=o.upscale;p&&!d&&(d=p),d&&!p&&(p=d);var y=u<p&&l<d;if(!y||y&&g){var v,m=p/u,w=d/l;"force"===h?(u=p,l=d):("cover"===h?v=Math.max(m,w):"contain"===h&&(v=Math.min(m,w)),u*=v,l*=v)}}var $={width:c,height:s};r.element.setAttribute("width",$.width),r.element.setAttribute("height",$.height);var E=Math.min(c/u,s/l);r.element.innerHTML="";var I=r.query("GET_IMAGE_PREVIEW_MARKUP_FILTER");a.filter(I).map(eN).sort(eL).forEach(function(e){var t,i,n=L(e,2),o=n[0],a=n[1],c=(t=o,i=a,eV[t](i));eS(c,o,a,$,E),r.element.appendChild(c)})}}}),Object.assign({},o)))}},n.ref.destroyMarkup=function(){n.ref.markup&&(n.removeChildView(n.ref.markup),n.ref.markup=null)};var a=n.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR");null!==a&&("grid"===a?n.element.dataset.transparencyIndicator=a:n.element.dataset.transparencyIndicator="color")},write:function e(t){var r=t.root,i=t.props,n=t.shouldOptimize,o=i.crop,a=i.markup,c=i.resize,s=i.dirty,u=i.width,l=i.height;r.ref.image.crop=o;var f={x:0,y:0,width:u,height:l,center:{x:.5*u,y:.5*l}},p={width:r.ref.image.width,height:r.ref.image.height},d={x:o.center.x*p.width,y:o.center.y*p.height},h={x:f.center.x-p.width*o.center.x,y:f.center.y-p.height*o.center.y},g=2*Math.PI+o.rotation%(2*Math.PI),y=o.aspectRatio||p.height/p.width,v=void 0===o.scaleToFit||o.scaleToFit,m=ej(p,e4(f,y),g,v?o.center:{x:.5,y:.5}),w=o.zoom*m;a&&a.length?(r.ref.createMarkup(),r.ref.markup.width=u,r.ref.markup.height=l,r.ref.markup.resize=c,r.ref.markup.dirty=s,r.ref.markup.markup=a,r.ref.markup.crop=e2(p,o)):r.ref.markup&&r.ref.destroyMarkup();var $=r.ref.image;if(n){$.originX=null,$.originY=null,$.translateX=null,$.translateY=null,$.rotateZ=null,$.scaleX=null,$.scaleY=null;return}$.originX=d.x,$.originY=d.y,$.translateX=h.x,$.translateY=h.y,$.rotateZ=g,$.scaleX=w,$.scaleY=w}}),{id:o.id,image:o.image,crop:o.crop,markup:o.markup,resize:o.resize,dirty:o.dirty,background:o.background}))},write:function e(t){var r=t.root,i=t.props,n=t.shouldOptimize,o=r.ref.clip,a=i.image,c=i.crop,s=i.markup,u=i.resize,l=i.dirty;if(o.crop=c,o.markup=s,o.resize=u,o.dirty=l,o.opacity=n?0:1,!n&&!r.rect.element.hidden){var f=a.height/a.width,p=c.aspectRatio||f,d=r.rect.inner.width,h=r.rect.inner.height,g=r.query("GET_IMAGE_PREVIEW_HEIGHT"),y=r.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),v=r.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),m=r.query("GET_PANEL_ASPECT_RATIO"),w=r.query("GET_ALLOW_MULTIPLE");m&&!w&&(g=d*m,p=m);var $=null!==g?g:Math.max(y,Math.min(d*p,v)),E=$/p;E>d&&($=(E=d)*p),$>h&&($=h,E=h/p),o.width=E,o.height=$}}}),a=t.utils.createWorker,c=function e(t,r,i){return new Promise(function(e){t.ref.imageData||(t.ref.imageData=i.getContext("2d").getImageData(0,0,i.width,i.height));var n=tt(t.ref.imageData);if(!r||20!==r.length)return i.getContext("2d").putImageData(n,0,0),e();var o=a(e1);o.post({imageData:n,colorMatrix:r},function(t){i.getContext("2d").putImageData(t,0,0),o.terminate(),e()},[n.data.buffer])})},s=function e(t,r){t.removeChildView(r),r.image.width=1,r.image.height=1,r._destroy()},u=function e(t){var r=t.root,i=r.ref.images.shift();return i.opacity=0,i.translateY=-15,r.ref.imageViewBin.push(i),i},l=function e(t){var r,i,n=t.root,a=t.props,c=t.image,s=a.id,u=n.query("GET_ITEM",{id:s});if(u){var l=u.getMetadata("crop")||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},f=n.query("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR"),p=!1;n.query("GET_IMAGE_PREVIEW_MARKUP_SHOW")&&(r=u.getMetadata("markup")||[],i=u.getMetadata("resize"),p=!0);var d=n.appendChildView(n.createChildView(o,{id:s,image:c,crop:l,resize:i,markup:r,dirty:p,background:f,opacity:0,scaleX:1.15,scaleY:1.15,translateY:15}),n.childViews.length);n.ref.images.push(d),d.opacity=1,d.scaleX=1,d.scaleY=1,d.translateY=0,setTimeout(function(){n.dispatch("DID_IMAGE_PREVIEW_SHOW",{id:s})},250)}},f=function e(t){var r=t.root,i=t.props,n=r.query("GET_ITEM",{id:i.id});if(n){var o=r.ref.images[r.ref.images.length-1];o.crop=n.getMetadata("crop"),o.background=r.query("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR"),r.query("GET_IMAGE_PREVIEW_MARKUP_SHOW")&&(o.dirty=!0,o.resize=n.getMetadata("resize"),o.markup=n.getMetadata("markup"))}},p=function e(t){var r=t.root,i=t.props,n=t.action;if(/crop|filter|markup|resize/.test(n.change.key)&&r.ref.images.length){var o=r.query("GET_ITEM",{id:i.id});if(o){if(/filter/.test(n.change.key)){var a=r.ref.images[r.ref.images.length-1];c(r,n.change.value,a.image);return}if(/crop|markup|resize/.test(n.change.key)){var s=o.getMetadata("crop"),p=r.ref.images[r.ref.images.length-1];if(s&&s.aspectRatio&&p.crop&&p.crop.aspectRatio&&Math.abs(s.aspectRatio-p.crop.aspectRatio)>1e-5){var d,h,g=u({root:r});l({root:r,props:i,image:(d=g.image,(h=h||document.createElement("canvas")).width=d.width,h.height=d.height,h.getContext("2d").drawImage(d,0,0),h)})}else f({root:r,props:i})}}}},d=function e(t){var r=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return!((r?parseInt(r[1]):null)<=58)&&"createImageBitmap"in window&&eJ(t)},h=function e(t){var r=t.root,i=t.props.id,n=r.query("GET_ITEM",i);n&&e7(URL.createObjectURL(n.file),function(e,t){r.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:i,width:e,height:t})})},g=function e(t){var r=t.root,i=t.props,n=i.id,o=r.query("GET_ITEM",n);if(o){var s=URL.createObjectURL(o.file),u=function e(){var t;(t=s,new Promise(function(e,r){var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){e(i)},i.onerror=function(e){r(e)},i.src=t})).then(f)},f=function e(t){URL.revokeObjectURL(s);var n=(o.getMetadata("exif")||{}).orientation||-1,a=t.width,u=t.height;if(a&&u){if(n>=5&&n<=8){var f=[u,a];a=f[0],u=f[1]}var p=Math.max(1,.75*window.devicePixelRatio),d=r.query("GET_IMAGE_PREVIEW_ZOOM_FACTOR")*p,h=u/a,g=r.rect.element.width,y=r.rect.element.height,v=g,m=v*h;h>1?m=(v=Math.min(a,g*d))*h:v=(m=Math.min(u,y*d))/h;var w=e9(t,v,m,n),$=function e(){var n=r.query("GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR")?eQ(data):null;o.setMetadata("color",n,!0),"close"in t&&t.close(),r.ref.overlayShadow.opacity=1,l({root:r,props:i,image:w})},E=o.getMetadata("filter");E?c(r,E,w).then($):$()}};if(d(o.file)){var p=a(eZ);p.post({file:o.file},function(e){if(p.terminate(),!e){u();return}f(e)})}else u()}},y=function e(t){var r=t.root,i=r.ref.images[r.ref.images.length-1];i.translateY=0,i.scaleX=1,i.scaleY=1,i.opacity=1},v=function e(t){var r=t.root;r.ref.overlayShadow.opacity=1,r.ref.overlayError.opacity=0,r.ref.overlaySuccess.opacity=0},m=function e(t){var r=t.root;r.ref.overlayShadow.opacity=.25,r.ref.overlayError.opacity=1},w=function e(t){var r=t.root;r.ref.overlayShadow.opacity=.25,r.ref.overlaySuccess.opacity=1},$=function e(t){var r=t.root;r.ref.images=[],r.ref.imageData=null,r.ref.imageViewBin=[],r.ref.overlayShadow=r.appendChildView(r.createChildView(n,{opacity:0,status:"idle"})),r.ref.overlaySuccess=r.appendChildView(r.createChildView(n,{opacity:0,status:"success"})),r.ref.overlayError=r.appendChildView(r.createChildView(n,{opacity:0,status:"failure"}))};return t.utils.createView({name:"image-preview-wrapper",create:$,styles:["height"],apis:["height"],destroy:function e(t){t.root.ref.images.forEach(function(e){e.image.width=1,e.image.height=1})},didWriteView:function e(t){t.root.ref.images.forEach(function(e){e.dirty=!1})},write:t.utils.createRoute({DID_IMAGE_PREVIEW_DRAW:y,DID_IMAGE_PREVIEW_CONTAINER_CREATE:h,DID_FINISH_CALCULATE_PREVIEWSIZE:g,DID_UPDATE_ITEM_METADATA:p,DID_THROW_ITEM_LOAD_ERROR:m,DID_THROW_ITEM_PROCESSING_ERROR:m,DID_THROW_ITEM_INVALID:m,DID_COMPLETE_ITEM_PROCESSING:w,DID_START_ITEM_PROCESSING:v,DID_REVERT_ITEM_PROCESSING:v},function(e){var t=e.root,r=t.ref.imageViewBin.filter(function(e){return 0===e.opacity});t.ref.imageViewBin=t.ref.imageViewBin.filter(function(e){return e.opacity>0}),r.forEach(function(e){return s(t,e)}),r.length=0})})},ti=function e(t){var r=t.addFilter,i=t.utils,n=i.Type,o=i.createRoute,a=i.isFile,c=tr(t);return r("CREATE_VIEW",function(e){var t=e.is,r=e.view,i=e.query;if(t("file")&&i("GET_ALLOW_IMAGE_PREVIEW")){var n=function e(t){var n=t.root,o=t.props.id,s=i("GET_ITEM",o);if(s&&a(s.file)&&!s.archived){var u,l=s.file;if(u=l,/^image/.test(u.type)&&i("GET_IMAGE_PREVIEW_FILTER_ITEM")(s)){var f="createImageBitmap"in(window||{}),p=i("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");if(f||!p||!(l.size>p)){n.ref.imagePreview=r.appendChildView(r.createChildView(c,{id:o}));var d=n.query("GET_IMAGE_PREVIEW_HEIGHT");d&&n.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:s.id,height:d});var h=!f&&l.size>i("GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE");n.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:o},h)}}}},s=function e(t,r){if(t.ref.imagePreview){var i=r.id,n=t.query("GET_ITEM",{id:i});if(n){var o=t.query("GET_PANEL_ASPECT_RATIO"),a=t.query("GET_ITEM_PANEL_ASPECT_RATIO"),c=t.query("GET_IMAGE_PREVIEW_HEIGHT");if(!o&&!a&&!c){var s=t.ref,u=s.imageWidth,l=s.imageHeight;if(u&&l){var f=t.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),p=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),d=(n.getMetadata("exif")||{}).orientation||-1;if(d>=5&&d<=8){var h=[l,u];u=h[0],l=h[1]}if(!eJ(n.file)||t.query("GET_IMAGE_PREVIEW_UPSCALE")){var g=2048/u;u*=g,l*=g}var y=l/u,v=(n.getMetadata("crop")||{}).aspectRatio||y,m=Math.max(f,Math.min(l,p)),w=t.rect.element.width;t.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:n.id,height:Math.min(w*v,m)})}}}}},u=function e(t){t.root.ref.shouldRescale=!0},l=function e(t){var r=t.root;"crop"===t.action.change.key&&(r.ref.shouldRescale=!0)},f=function e(t){var r=t.root,i=t.action;r.ref.imageWidth=i.width,r.ref.imageHeight=i.height,r.ref.shouldRescale=!0,r.ref.shouldDrawPreview=!0,r.dispatch("KICK")};r.registerWriter(o({DID_RESIZE_ROOT:u,DID_STOP_RESIZE:u,DID_LOAD_ITEM:n,DID_IMAGE_PREVIEW_CALCULATE_SIZE:f,DID_UPDATE_ITEM_METADATA:l},function(e){var t=e.root,r=e.props;t.ref.imagePreview&&!t.rect.element.hidden&&(t.ref.shouldRescale&&(s(t,r),t.ref.shouldRescale=!1),t.ref.shouldDrawPreview&&(requestAnimationFrame(function(){requestAnimationFrame(function(){t.dispatch("DID_FINISH_CALCULATE_PREVIEWSIZE",{id:r.id})})}),t.ref.shouldDrawPreview=!1))}))}}),{options:{allowImagePreview:[!0,n.BOOLEAN],imagePreviewFilterItem:[function(){return!0},n.FUNCTION],imagePreviewHeight:[null,n.INT],imagePreviewMinHeight:[44,n.INT],imagePreviewMaxHeight:[256,n.INT],imagePreviewMaxFileSize:[null,n.INT],imagePreviewZoomFactor:[2,n.INT],imagePreviewUpscale:[!1,n.BOOLEAN],imagePreviewMaxInstantPreviewFileSize:[1e6,n.INT],imagePreviewTransparencyIndicator:[null,n.STRING],imagePreviewCalculateAverageImageColor:[!1,n.BOOLEAN],imagePreviewMarkupShow:[!0,n.BOOLEAN],imagePreviewMarkupFilter:[function(){return!0},n.FUNCTION]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:ti})),ti});